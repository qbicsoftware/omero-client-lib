# Build script for Travis CI
#

# use xenial distribution
dist: xenial

# no need to check for oracle's java
language: java
jdk: openjdk8

# speed up builds by caching maven local repository
cache:
  directories:
  - "$HOME/.m2/repository"

# as agreed in our SOP
branches:
  only:
  - master
  - development

# added to make logs look cleaner, crisper, certified fresh
before_install: unset _JAVA_OPTIONS 

# speed up builds by telling Travis that we don't need any special "installation"
install: true

# check if we need to add a license file for Vaadin charts
before_script: if [ "$VAADIN_CHARTS_LICENSE_CODE" != "" ]; then
                  echo "$VAADIN_CHARTS_LICENSE_CODE" > ~/.vaadin.charts.developer.license;
               fi;

# as agreed in our SOP, build everything (don't deploy, just try to 'mvn install' locally, which covers all phases)
script: mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml clean cobertura:cobertura install
# upload code coverage report, generate maven site (javadocs, documentation, static code analysis, etc.)
after_success: 
- bash <(curl -s https://codecov.io/bash)
- mvn --quiet --activate-profiles !development-build,!release-build --settings .travis.settings.xml site

# upload to maven
deploy:
  # as agreed in our SOP, builds on development branch will deploy to our maven repository after validating
  # the artifact has a proper SNAPSHOT version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles development-build,!release-build --settings .travis.settings.xml deploy
  on:
    branch: development
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'
  # as agreed in our SOP, tagging a commit on the master branch will upload to our maven repository
  # after validating the artifact has a proper release version
  # artifact will be installed in our testing instance if it is a .war file
- skip_cleanup: true
  provider: script
  script: mvn --quiet --activate-profiles !development-build,release-build --settings .travis.settings.xml deploy
  on:
    branch: master
    condition: '"$TRAVIS_EVENT_TYPE" = "push"'

env:
  global:
    - secure: "GubWHnTtaft+EROZbU6+eAPA9grohYxHZ1dRO1Az/NMwPlPFXhaOQd22gxjwE518pb+QBHfg6kXnGzSl4LyGxOql/RiTpRXCnId7Q7aKITSeKKzgh/uobXY1vljEpPgag//4/fbJk5bYVZyo3B4J1OG65P9YF6KwNw1/FB9owGDSl8gercm+QxSAvA5yi0yJfOm+XAlUpwWuTnW2yIeup1slpsjEXg2p3LSMj6LwA41S7ysXd0cVrVtAgRviTSyAD1LTCMpLWrMV5Mwqn3cphVedzXJxJJRro1gztq3gQbHEkZVVT97sVZZPm80PJcsdyg177WzEiRN67u5J3TxISZJLzSd3co4r1gsc3ckyF0E8jvfP3RFRPOoiBlK83wvB6YED6gWz07nbhUY+kThE6V5iG2LB3w/blnrUDxtK7kQB7tbR0g5ltWQnICvHv6DAhjooJzBmNIIcZFLS3uiO96ZLQKBObNV3MX6U+I9+e7v47JGOVpHZCaYOIcnfFFfTMbSEywuizRYDckhP83iAeqUXgCdlJkbs/J4oHSNkkLNE+L+gB3R/KusDbUvUROejVLmEfRwzuDe7bh4vx3QbXqRFFFOt02THtkavoiAdvFzVwNTOfGVaHsaVLx0uMwWRAnx8qBmVMXC+SN8Kz8RJoxoPaG/TErvEWjku/mYxAsE="
    - secure: "ECntPzE+udN2lsoH0DSlfyJSgrWKCM3PGKr0Md9dy2hVsyBV056DfDAwTavOXF94XDiw8vopEg9vSDjduw6PY0thA0XE0THgwvWaYtQeoTzx9LuBUmeRgvuWbJ59+8cl0r5kC8B9jZ7azLV9UklLWvGYlygurFQWUcWGMO9Mu1foppa9YN8XwbVfc35qJIbbgHyALtA+4oSJ5ScDR7YZi5mRoHB/962Bx5w9B0whJdZUxO80+b1fr0eS3uZXtTlAOykglpPhit1NfP5VXPeVFAFFwjbK5o56+/ZLfEiv8wSkjIaKy790A3+Xur252avBT2sxxu84o7U5tDEGCLdJrnHILtEp61gvfRiXPbC7IE763WhAdRASNOQX0820h/M1v5/qzfKlLhx60dQVlIhg7zA7h4gbFO68d/owebdaONdXGM0gM42ctbcRpBrzbHZ2Jyeghk6OevhuXZba6LNQ6+PWpAtwAG4fKmdf0W+6R+eFoY2M4FJUio2xxQ259AbI8yrHhDhNQkXruPpzoy49oC95V6j/2urRkxOK60wqByds/BBZvN3x8rSr6XX64M6KhE/c3yg2p4gGPzOVnJ0rWzQTcsTjxWJmeTSvK3eFPqUGrlUl8WsUYpbwFylWouh+mFtJyRMPPC3M8X4mFUoZdUSPMNFQOR1z1J0CxcCXLfs="

# change according to your needs, but we recommend to deactivate email notifications
# for now, we configured Travis to send a notification to the #travis-ci channel 
notifications:
  email:
    on_success: never
    on_failure: never
  slack: 
    on_success: never
    on_failure: always
    # edit the following section if you want to get slack notifications
    rooms:
      - secure: "***"
